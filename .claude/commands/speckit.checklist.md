---
description: ユーザー要件に基づいて、現在の機能のカスタムチェックリストを生成します。
---

## チェックリストの目的: 「英語のためのユニットテスト」

**重要なコンセプト**: チェックリストは**要件記述のユニットテスト**です - 特定のドメインにおける要件の品質、明確さ、完全性を検証します。

**検証/テストのためではありません**:

- ❌ 「ボタンが正しくクリックされることを確認する」ではない
- ❌ 「エラーハンドリングが機能することをテストする」ではない
- ❌ 「APIが200を返すことを確認する」ではない
- ❌ コード/実装が仕様と一致するかをチェックするものではない

**要件品質の検証のため**:

- ✅ 「すべてのカードタイプに対してビジュアル階層の要件が定義されているか？」（完全性）
- ✅ 「'目立つ表示'は具体的なサイジング/配置で定量化されているか？」（明確さ）
- ✅ 「ホバー状態の要件はすべてのインタラクティブ要素で一貫しているか？」（一貫性）
- ✅ 「キーボードナビゲーションのアクセシビリティ要件が定義されているか？」（カバレッジ）
- ✅ 「ロゴ画像の読み込みに失敗した場合の対応を仕様で定義しているか？」（エッジケース）

**メタファー**: 仕様が英語で書かれたコードだとすれば、チェックリストはそのユニットテストスイートです。要件が適切に記述され、完全で、曖昧さがなく、実装の準備ができているかをテストしているのであり、実装が機能するかをテストしているのではありません。

## ユーザー入力

```text
$ARGUMENTS
```

続行する前に、ユーザー入力を**必ず**考慮してください（空でない場合）。

## 実行ステップ

1. **セットアップ**: リポジトリルートから `.specify/scripts/bash/check-prerequisites.sh --json` を実行し、JSONをパースしてFEATURE_DIRとAVAILABLE_DOCSリストを取得します。
   - すべてのファイルパスは絶対パスである必要があります。
   - "I'm Groot"のような引数内のシングルクォートには、エスケープ構文を使用してください：例 'I'\''m Groot'（または可能であればダブルクォート："I'm Groot"）。

2. **意図の明確化（動的）**: 最大3つの初期の文脈的な明確化質問を導き出します（事前に用意されたカタログではありません）。これらは以下を満たす必要があります：
   - ユーザーの表現 + spec/plan/tasksから抽出されたシグナルから生成される
   - チェックリストの内容に実質的な変更をもたらす情報についてのみ質問する
   - `$ARGUMENTS`で既に明確な場合は個別にスキップする
   - 幅広さよりも精度を優先する

   生成アルゴリズム：
   1. シグナルを抽出：機能ドメインキーワード（例：auth、latency、UX、API）、リスク指標（"critical"、"must"、"compliance"）、ステークホルダーヒント（"QA"、"review"、"security team"）、および明示的な成果物（"a11y"、"rollback"、"contracts"）。
   2. シグナルを候補フォーカスエリア（最大4つ）にクラスター化し、関連性でランク付けします。
   3. 明示的でない場合、想定される対象者とタイミング（作成者、レビュアー、QA、リリース）を特定します。
   4. 欠落している次元を検出：スコープの幅、深さ/厳密さ、リスクの強調、除外境界、測定可能な受け入れ基準。
   5. 以下のアーキタイプから選択された質問を策定します：
      - スコープの絞り込み（例："これはXとYとの統合タッチポイントを含めるべきか、ローカルモジュールの正確性に限定するべきか？"）
      - リスクの優先順位付け（例："これらの潜在的リスクエリアのうち、どれが必須のゲーティングチェックを受けるべきか？"）
      - 深さの調整（例："これは軽量なプリコミットの健全性リストか、正式なリリースゲートか？"）
      - 対象者のフレーミング（例："これは作成者のみが使用するのか、PRレビュー中の同僚が使用するのか？"）
      - 境界の除外（例："今回はパフォーマンスチューニング項目を明示的に除外すべきか？"）
      - シナリオクラスのギャップ（例："復旧フローが検出されませんでした—ロールバック/部分的な失敗パスはスコープ内ですか？"）

   質問のフォーマット規則：
   - オプションを提示する場合は、以下の列を持つコンパクトなテーブルを生成します：Option | Candidate | Why It Matters
   - オプションは最大A～Eに制限します。自由形式の回答の方が明確な場合はテーブルを省略します
   - ユーザーが既に言ったことを言い直すよう求めない
   - 推測的なカテゴリを避ける（幻覚なし）。不確実な場合は明示的に質問します："Xがスコープに含まれるかどうか確認してください。"

   対話が不可能な場合のデフォルト：
   - 深さ：標準
   - 対象者：コード関連の場合はレビュアー（PR）、それ以外は作成者
   - フォーカス：上位2つの関連性クラスター

   質問を出力します（Q1/Q2/Q3のラベルを付ける）。回答後：2つ以上のシナリオクラス（代替/例外/復旧/非機能ドメイン）が不明瞭なままの場合、1行の正当化（例："未解決の復旧パスリスク"）を付けて、最大2つの追加のターゲット質問（Q4/Q5）を行うことができます。合計5つの質問を超えないでください。ユーザーが明示的に拒否した場合はエスカレーションをスキップします。

3. **ユーザーリクエストの理解**: `$ARGUMENTS` + 明確化の回答を組み合わせます：
   - チェックリストのテーマを導き出す（例：セキュリティ、レビュー、デプロイ、UX）
   - ユーザーが言及した明示的な必須項目を統合する
   - フォーカスの選択をカテゴリの骨組みにマッピングする
   - spec/plan/tasksから不足しているコンテキストを推測する（幻覚を起こさない）

4. **機能コンテキストの読み込み**: FEATURE_DIRから読み込みます：
   - spec.md：機能の要件とスコープ
   - plan.md（存在する場合）：技術的詳細、依存関係
   - tasks.md（存在する場合）：実装タスク

   **コンテキスト読み込み戦略**：
   - アクティブなフォーカスエリアに関連する必要な部分のみを読み込む（ファイル全体のダンプを避ける）
   - 長いセクションを簡潔なシナリオ/要件箇条書きに要約することを優先する
   - 段階的な開示を使用：ギャップが検出された場合にのみ、追加の取得を行う
   - ソースドキュメントが大きい場合は、生テキストを埋め込む代わりに中間要約項目を生成する

5. **チェックリストの生成** - 「要件のためのユニットテスト」を作成：
   - `FEATURE_DIR/checklists/` ディレクトリが存在しない場合は作成します
   - 一意のチェックリストファイル名を生成します：
     - ドメインに基づいた短く説明的な名前を使用（例：`ux.md`、`api.md`、`security.md`）
     - フォーマット：`[domain].md`
     - ファイルが存在する場合は既存のファイルに追加します
   - CHK001から順次アイテム番号を付けます
   - 各 `/speckit.checklist` 実行は新しいファイルを作成します（既存のチェックリストを上書きしません）

   **核心原則 - 実装ではなく要件をテストする**：
   すべてのチェックリスト項目は、要件自体を以下の点で評価する必要があります：
   - **完全性**：必要なすべての要件が存在するか？
   - **明確さ**：要件は明確で具体的か？
   - **一貫性**：要件は互いに整合しているか？
   - **測定可能性**：要件は客観的に検証できるか？
   - **カバレッジ**：すべてのシナリオ/エッジケースが対処されているか？

   **カテゴリ構造** - 要件品質の次元でアイテムをグループ化：
   - **要件の完全性**（必要なすべての要件が文書化されているか？）
   - **要件の明確さ**（要件は具体的で曖昧さがないか？）
   - **要件の一貫性**（要件は矛盾なく整合しているか？）
   - **受け入れ基準の品質**（成功基準は測定可能か？）
   - **シナリオカバレッジ**（すべてのフロー/ケースが対処されているか？）
   - **エッジケースカバレッジ**（境界条件が定義されているか？）
   - **非機能要件**（パフォーマンス、セキュリティ、アクセシビリティなどが指定されているか？）
   - **依存関係と仮定**（それらは文書化され、検証されているか？）
   - **曖昧さと矛盾**（何を明確化する必要があるか？）

   **チェックリスト項目の書き方 - "英語のためのユニットテスト"**：

   ❌ **誤り**（実装のテスト）：
   - "ランディングページに3つのエピソードカードが表示されることを確認する"
   - "デスクトップでホバー状態が機能することをテストする"
   - "ロゴクリックでホームに移動することを確認する"

   ✅ **正しい**（要件品質のテスト）：
   - "注目エピソードの正確な数とレイアウトが指定されているか？" [完全性]
   - "'目立つ表示'は特定のサイジング/配置で定量化されているか？" [明確さ]
   - "ホバー状態の要件はすべてのインタラクティブ要素で一貫しているか？" [一貫性]
   - "すべてのインタラクティブUIに対してキーボードナビゲーション要件が定義されているか？" [カバレッジ]
   - "ロゴ画像の読み込みに失敗した場合のフォールバック動作が指定されているか？" [エッジケース]
   - "非同期エピソードデータの読み込み状態が定義されているか？" [完全性]
   - "競合するUI要素のビジュアル階層が仕様で定義されているか？" [明確さ]

   **項目構造**：
   各項目は以下のパターンに従う必要があります：
   - 要件品質について尋ねる質問形式
   - spec/planに書かれている（または書かれていない）ことに焦点を当てる
   - 品質次元を角括弧で含める [完全性/明確さ/一貫性/など]
   - 既存の要件をチェックする際は仕様セクション `[Spec §X.Y]` を参照する
   - 不足している要件をチェックする際は `[Gap]` マーカーを使用する

   **品質次元別の例**：

   完全性：
   - "すべてのAPI失敗モードに対してエラー処理要件が定義されているか？ [Gap]"
   - "すべてのインタラクティブ要素に対してアクセシビリティ要件が指定されているか？ [完全性]"
   - "レスポンシブレイアウトのためのモバイルブレークポイント要件が定義されているか？ [Gap]"

   明確さ：
   - "'高速読み込み'は特定のタイミングしきい値で定量化されているか？ [明確さ, Spec §NFR-2]"
   - "'関連エピソード'の選択基準が明示的に定義されているか？ [明確さ, Spec §FR-5]"
   - "'目立つ'は測定可能な視覚的特性で定義されているか？ [曖昧さ, Spec §FR-4]"

   一貫性：
   - "ナビゲーション要件はすべてのページで整合しているか？ [一貫性, Spec §FR-10]"
   - "カードコンポーネントの要件はランディングページと詳細ページで一貫しているか？ [一貫性]"

   カバレッジ：
   - "ゼロ状態シナリオ（エピソードなし）の要件が定義されているか？ [カバレッジ, エッジケース]"
   - "同時ユーザーインタラクションシナリオが対処されているか？ [カバレッジ, Gap]"
   - "部分的なデータ読み込み失敗の要件が指定されているか？ [カバレッジ, 例外フロー]"

   測定可能性：
   - "ビジュアル階層の要件は測定可能/テスト可能か？ [受け入れ基準, Spec §FR-1]"
   - "'バランスの取れた視覚的重み'は客観的に検証できるか？ [測定可能性, Spec §FR-2]"

   **シナリオ分類とカバレッジ**（要件品質フォーカス）：
   - 以下のシナリオに対する要件が存在するかチェック：プライマリ、代替、例外/エラー、復旧、非機能シナリオ
   - 各シナリオクラスに対して質問："[シナリオタイプ]要件は完全で、明確で、一貫しているか？"
   - シナリオクラスが欠落している場合："[シナリオタイプ]要件は意図的に除外されているか、それとも欠落しているか？ [Gap]"
   - 状態変更が発生する場合は回復力/ロールバックを含める："マイグレーション失敗のロールバック要件が定義されているか？ [Gap]"

   **トレーサビリティ要件**：
   - 最小要件：項目の≥80%は少なくとも1つのトレーサビリティ参照を含む必要があります
   - 各項目は以下を参照する必要があります：仕様セクション `[Spec §X.Y]`、またはマーカーを使用：`[Gap]`、`[Ambiguity]`、`[Conflict]`、`[Assumption]`
   - IDシステムが存在しない場合："要件と受け入れ基準のIDスキームが確立されているか？ [トレーサビリティ]"

   **問題の表面化と解決**（要件品質の問題）：
   要件自体について質問します：
   - 曖昧さ："'高速'という用語は特定のメトリクスで定量化されているか？ [曖昧さ, Spec §NFR-1]"
   - 矛盾："§FR-10と§FR-10aの間でナビゲーション要件が矛盾しているか？ [矛盾]"
   - 仮定："'常に利用可能なポッドキャストAPI'の仮定は検証されているか？ [仮定]"
   - 依存関係："外部ポッドキャストAPIの要件が文書化されているか？ [依存関係, Gap]"
   - 定義の欠落："'ビジュアル階層'は測定可能な基準で定義されているか？ [Gap]"

   **コンテンツの統合**：
   - ソフトキャップ：生の候補項目が40を超える場合、リスク/影響で優先順位を付ける
   - 同じ要件の側面をチェックする重複に近いものをマージする
   - 低影響のエッジケースが5つを超える場合、1つの項目を作成："要件でエッジケースX、Y、Zが対処されているか？ [カバレッジ]"

   **🚫 絶対禁止** - これらは実装テストになり、要件テストではありません：
   - ❌ "Verify"、"Test"、"Confirm"、"Check" + 実装動作で始まる項目
   - ❌ コード実行、ユーザーアクション、システム動作への参照
   - ❌ "正しく表示される"、"適切に機能する"、"期待通りに動作する"
   - ❌ "クリック"、"ナビゲート"、"レンダリング"、"読み込み"、"実行"
   - ❌ テストケース、テスト計画、QA手順
   - ❌ 実装の詳細（フレームワーク、API、アルゴリズム）

   **✅ 必須パターン** - これらは要件品質をテストします：
   - ✅ "[要件タイプ]は[シナリオ]に対して定義/指定/文書化されているか？"
   - ✅ "[曖昧な用語]は特定の基準で定量化/明確化されているか？"
   - ✅ "[セクションA]と[セクションB]の間で要件は一貫しているか？"
   - ✅ "[要件]は客観的に測定/検証できるか？"
   - ✅ "[エッジケース/シナリオ]は要件で対処されているか？"
   - ✅ "仕様は[欠落している側面]を定義しているか？"

6. **構造参照**: `.specify/templates/checklist-template.md` の正規テンプレートに従ってチェックリストを生成します（タイトル、メタセクション、カテゴリ見出し、IDフォーマット）。テンプレートが利用できない場合は以下を使用：H1タイトル、目的/作成メタ行、`##` カテゴリセクション、CHK001から始まるグローバルにインクリメントするIDを持つ `- [ ] CHK### <要件項目>` 行。

7. **レポート**: 作成されたチェックリストへのフルパス、項目数を出力し、各実行が新しいファイルを作成することをユーザーに思い出させます。要約：
   - 選択されたフォーカスエリア
   - 深さレベル
   - アクター/タイミング
   - 組み込まれたユーザー指定の必須項目

**重要**: 各 `/speckit.checklist` コマンド呼び出しは、ファイルが既に存在しない限り、短く説明的な名前を使用してチェックリストファイルを作成します。これにより以下が可能になります：

- 異なるタイプの複数のチェックリスト（例：`ux.md`、`test.md`、`security.md`）
- チェックリストの目的を示すシンプルで覚えやすいファイル名
- `checklists/` フォルダ内での簡単な識別とナビゲーション

混乱を避けるため、説明的なタイプを使用し、完了したら廃止されたチェックリストをクリーンアップしてください。

## チェックリストタイプと項目例

**UX要件品質:** `ux.md`

項目例（実装ではなく要件をテスト）：

- "ビジュアル階層の要件は測定可能な基準で定義されているか？ [明確さ, Spec §FR-1]"
- "UI要素の数と配置が明示的に指定されているか？ [完全性, Spec §FR-1]"
- "インタラクション状態の要件（ホバー、フォーカス、アクティブ）は一貫して定義されているか？ [一貫性]"
- "すべてのインタラクティブ要素に対してアクセシビリティ要件が指定されているか？ [カバレッジ, Gap]"
- "画像の読み込みに失敗した場合のフォールバック動作が定義されているか？ [エッジケース, Gap]"
- "'目立つ表示'は客観的に測定できるか？ [測定可能性, Spec §FR-4]"

**API要件品質:** `api.md`

項目例：

- "すべての失敗シナリオに対してエラーレスポンス形式が指定されているか？ [完全性]"
- "レート制限要件は特定のしきい値で定量化されているか？ [明確さ]"
- "すべてのエンドポイントで認証要件が一貫しているか？ [一貫性]"
- "外部依存関係に対する再試行/タイムアウト要件が定義されているか？ [カバレッジ, Gap]"
- "バージョニング戦略が要件に文書化されているか？ [Gap]"

**パフォーマンス要件品質:** `performance.md`

項目例：

- "パフォーマンス要件は特定のメトリクスで定量化されているか？ [明確さ]"
- "すべての重要なユーザージャーニーに対してパフォーマンスターゲットが定義されているか？ [カバレッジ]"
- "異なる負荷条件下でのパフォーマンス要件が指定されているか？ [完全性]"
- "パフォーマンス要件は客観的に測定できるか？ [測定可能性]"
- "高負荷シナリオの劣化要件が定義されているか？ [エッジケース, Gap]"

**セキュリティ要件品質:** `security.md`

項目例：

- "すべての保護されたリソースに対して認証要件が指定されているか？ [カバレッジ]"
- "機密情報に対してデータ保護要件が定義されているか？ [完全性]"
- "脅威モデルが文書化され、要件がそれに整合しているか？ [トレーサビリティ]"
- "セキュリティ要件はコンプライアンス義務と一貫しているか？ [一貫性]"
- "セキュリティ失敗/侵害対応要件が定義されているか？ [Gap, 例外フロー]"

## アンチパターン例：やってはいけないこと

**❌ 誤り - これらは実装をテストしており、要件ではありません：**

```markdown
- [ ] CHK001 - ランディングページに3つのエピソードカードが表示されることを確認する [Spec §FR-001]
- [ ] CHK002 - デスクトップでホバー状態が正しく機能することをテストする [Spec §FR-003]
- [ ] CHK003 - ロゴクリックでホームページに移動することを確認する [Spec §FR-010]
- [ ] CHK004 - 関連エピソードセクションに3-5項目が表示されることをチェックする [Spec §FR-005]
```

**✅ 正しい - これらは要件品質をテストしています：**

```markdown
- [ ] CHK001 - 注目エピソードの数とレイアウトが明示的に指定されているか？ [完全性, Spec §FR-001]
- [ ] CHK002 - すべてのインタラクティブ要素に対してホバー状態の要件が一貫して定義されているか？ [一貫性, Spec §FR-003]
- [ ] CHK003 - すべてのクリック可能なブランド要素に対してナビゲーション要件が明確か？ [明確さ, Spec §FR-010]
- [ ] CHK004 - 関連エピソードの選択基準が文書化されているか？ [Gap, Spec §FR-005]
- [ ] CHK005 - 非同期エピソードデータの読み込み状態要件が定義されているか？ [Gap]
- [ ] CHK006 - "ビジュアル階層"要件は客観的に測定できるか？ [測定可能性, Spec §FR-001]
```

**主な違い：**

- 誤り：システムが正しく動作するかをテストする
- 正しい：要件が正しく記述されているかをテストする
- 誤り：動作の検証
- 正しい：要件品質の検証
- 誤り："Xを実行するか？"
- 正しい："Xは明確に指定されているか？"
